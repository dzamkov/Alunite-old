using System;
using System.Collections.Generic;


using OpenTK;
using OpenTK.Graphics;
using OpenTK.Graphics.OpenGL;

namespace Alunite
{
    /// <summary>
    /// Contains cached data and settings for rendering.
    /// </summary>
    public class Visual
    {
        /// <summary>
        /// Creates a new visual context.
        /// </summary>
        public static Visual Create()
        {
            return new Visual();
        }

        /// <summary>
        /// Gets a signal of views that shows what is seen by an untransformed camera in an environment.
        /// </summary>
        public static Signal<View> GetViewFeed(Span Environment)
        {
            return new ViewSignal(Environment);
        }

        /// <summary>
        /// Renders an entity to the current graphics context.
        /// </summary>
        public void Render(Entity Entity)
        {
            
        }
    }

    /// <summary>
    /// A signal of views generated by cameras.
    /// </summary>
    public class ViewSignal : Signal<View>
    {
        public ViewSignal(Span Environment)
        {
            this._Environment = Environment;
        }

        public override View this[double Time]
        {
            get
            {
                return new View(this._Environment[Time]);
            }
        }

        public override Signal<View> Simplify
        {
            get
            {
                this._Environment = this._Environment.Simplify;
                return this;
            }
        }

        private Span _Environment;
    }

    /// <summary>
    /// A view of a simulation that can be rendered to a graphics context.
    /// </summary>
    public class View
    {
        public View(Entity Entity)
        {
            this._Entity = Entity;
        }

        /// <summary>
        /// Gets the single entity that represents what is seen. The view is looking at the entity from (0.0, 0.0, 0.0) towards (1.0, 0.0, 0.0) with
        /// (0.0, 0.0, 1.0) as the up vector.
        /// </summary>
        public Entity Entity
        {
            get
            {
                return this._Entity;
            }
        }

        /// <summary>
        /// Renders this view to the current graphics context using the given visual data. The projection for the view should be set up before
        /// this call.
        /// </summary>
        public void Render(Visual Visual)
        {
            Visual.Render(this._Entity);
        }

        private Entity _Entity;
    }
}